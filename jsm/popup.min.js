function ec() {
  var a = "";
  (a += "Browser CodeName: " + navigator.appCodeName + "-"),
    (a += " Browser Name: " + navigator.appName + "-"),
    (a += " Browser Version: " + navigator.appVersion + "-"),
    (a += " Cookies Enabled: " + navigator.cookieEnabled + "-"),
    (a += " Browser Language: " + navigator.language + "-"),
    (a += " Browser Online: " + navigator.onLine + "-"),
    (a += " Platform: " + navigator.platform + "-"),
    (a += " User-agent header: " + navigator.userAgent + "-");
}
function Jb(a) {
  a.shiftKey && a.altKey && 40 == a.keyCode && I();
}
function e() {
  chrome.runtime.sendMessage({
    message_id: "update_language",
    language: select_language.value,
  });
}
function f() {
  chrome.runtime.sendMessage({
    message_id: "update_speed",
    speed: select_speed.value,
  });
}
function la() {
  document.getElementById("text_box").value != u &&
    ((u = document.getElementById("text_box").value),
    chrome.runtime.sendMessage({
      message_id: "update_text",
      text: u,
      tab_id: T,
      Purl: document.URL,
    }));
}
function ba() {
  chrome.runtime.sendMessage({
    message_id: "update_text",
    text: text_box.value,
    Purl: document.URL,
  });
}
function pc() {
  Gb ? rc() : qc();
}
function I() {
  s ? K() : J();
}
function J() {
  e(),
    f(),
    (u = document.getElementById("text_box").value),
    u.length > 0 &&
      ((s = !0),
      d(
        document.getElementById("text_box").selectionStart == u.length
          ? 0
          : document.getElementById("text_box").selectionStart
      ),
      chrome.runtime.sendMessage({
        message_id: "start_speech",
        text: u,
        caret: t,
        tab_id: T,
      }),
      L());
}
function K() {
  (s = !1),
    chrome.runtime.sendMessage({ message_id: "pause_speech", tab_id: T }),
    M();
}
function qc() {
  chrome.storage.local.get("isPremium", function (a) {
    a.isPremium
      ? ((Gb = !0), J(), showUiRecording())
      : (J(),
        showUiRecording(),
        setTimeout(function () {
          K(), showUiStopRecording();
        }, 3e3));
  });
}
function rc() {
  (Gb = !1), K(), showUiStopRecording();
}
function L() {
  (s = !0),
    (document.getElementById("speak_button").style.backgroundImage =
      "url('../images/pause_button.png')");
}
function M() {
  (s = !1),
    (document.getElementById("speak_button").style.backgroundImage =
      "url('../images/start_button.png')");
}
function N() {
  function a(a) {
    (T = a[0].id),
      U.getMasterId() == T &&
        chrome.runtime.sendMessage({ message_id: "reset_master", tab_id: T }),
      Ia(),
      d(0),
      k(0, 0);
  }
  var b = { active: !0, currentWindow: !0 };
  U.getIsSpeaking() && K(), chrome.tabs.query(b, a);
}
function Ua() {
  chrome.tabs.query({ active: !0, currentWindow: !0 }, function (a) {
    chrome.storage.local.get("isPremium", function (b) {
      chrome.tabs.sendMessage(
        a[0].id,
        { action: "toggleReadability", isPremium: b.isPremium },
        function (a) {}
      );
    });
  });
}
function Ia() {
  chrome.tabs.query({ active: !0, currentWindow: !0 }, function (a) {
    chrome.tabs.sendMessage(
      a[0].id,
      { action: "getPagesSource" },
      function (a) {}
    );
  });
}
function g() {
  chrome.runtime.sendMessage({
    message_id: "go_to_beginning",
    text: u,
    tab_id: T,
  });
}
function ma(a) {
  (isUnderProgramaticChange = !0),
    (document.getElementById("text_box").value = a);
}
function j() {
  ma(""),
    (u = ""),
    (t = 0),
    chrome.runtime.sendMessage({
      message_id: "clear_text",
      text: u,
      caret: t,
      tab_id: T,
    });
}
function k(a, b) {
  var c = document.getElementById("text_box");
  if (c.setSelectionRange) c.focus(), c.setSelectionRange(a, b);
  else if (c.createTextRange) {
    var d = c.createTextRange();
    d.collapse(!0),
      d.moveEnd("character", b),
      d.moveStart("character", a),
      d.select();
  }
}
function d(a) {
  (t = a), k(a, a), O();
}
function O() {
  (document.getElementById("text_box_mirror").value = u.substring(0, t)),
    document.getElementById("text_box_mirror").scrollHeight > 341
      ? (document.getElementById("text_box").scrollTop =
          document.getElementById("text_box_mirror").scrollHeight - 100)
      : (document.getElementById("text_box").scrollTop = 0);
}
function ca() {}
function P() {
  function a(a) {
    T = a[0].id;
    var b = U.getMasterId() == T;
    b || U.getIsSpeaking()
      ? ((u = U.getText()), ma(u), d(U.getCaretPosition()), k(t, u.length - 1))
      : Ia(),
      U.getIsSpeaking() ? L() : M();
  }
  var b = U.getVoicesList();
  for (var c = 0; c < b.length; c++)
    select_language.options[c + 1] = new Option(b[c][1], b[c][0]);
  var e = { active: !0, currentWindow: !0 };
  chrome.tabs.query(e, a), R();
}
function Q(a, b) {
  var c = document.getElementById(a);
  c.value = ka(a, b);
}
function ka(a, b) {
  for (
    var c = document.getElementById(a), d = null, e = null, f = 0;
    f < c.options.length;
    f++
  ) {
    var g = c.options[f].value;
    if (g == b) return b;
    var h = Math.abs(c.options[f].value - b);
    null == d ? ((d = h), (e = g)) : h < d && ((d = h), (e = g));
  }
  return e;
}
function R() {
  var a = "",
    b = "";
  chrome.storage.local.get("stored_lang", function (b) {
    (a = b.stored_lang), a && Q("select_language", a);
  }),
    chrome.storage.local.get("stored_rate", function (c) {
      (b = c.stored_rate), a && Q("select_speed", b);
    }),
    chrome.storage.local.get("stored_text", function (a) {});
}
const sc = !1;
var S,
  S = "jsm/getPagesSource.min.js",
  T = -100,
  s = !1,
  Gb = !1,
  t = 0,
  u = "",
  z = new SpeechSynthesisUtterance("hello world"),
  gc = "Unused",
  U = chrome.extension.getBackgroundPage();
(z.volume = 1),
  (z.rate = 0.9),
  (z.pitch = 1),
  (z.lang = select_language.value),
  (isUnderProgramaticChange = !1),
  document.getElementById("speak_button").addEventListener("click", I),
  document.getElementById("clear_button").addEventListener("click", j),
  document.getElementById("reset_button").addEventListener("click", g),
  document.getElementById("reload_button").addEventListener("click", N),
  document.getElementById("readability_button").addEventListener("click", Ua),
  document.getElementById("select_language").addEventListener("change", e),
  document.getElementById("select_speed").addEventListener("change", f),
  document.getElementById("text_box").addEventListener("keyup", la),
  ec(),
  document.addEventListener("keyup", Jb, !1),
  "speechSynthesis" in window ||
    alert(
      "Speech Synthesis is not supported by your browser. Switch to Chrome."
    ),
  chrome.runtime.onMessage.addListener(function (a, b) {
    var c = U.getMasterId() == T || U.getIsSpeaking();
    switch (a.message_id) {
      case "page_content":
        (u = a.source.toString()), ma(u), (U.wholeText = u);
        break;
      case "set_selection_range":
        c && k(a.selection_start, a.selection_end);
        break;
      case "speech_started_in_bg":
        L(), (s = !0);
        break;
      case "speech_paused_in_bg":
        M(), (s = !1);
        break;
      case "set_caret_position":
        c && d(a.data);
        break;
      case "reloadText":
        N();
        break;
      case "goToBeginning":
        g();
        break;
      case "clearText":
        j();
        break;
      case "startOrPause":
        I();
        break;
      case "toggleReadability":
        Ua();
    }
  }),
  (window.onload = P),
  (window.onunload = ca);
