function C(a, b) {
  var c,
    d = "",
    e = "",
    f = a.firstChild;
  for (a.getElementsByClassName("article-content"), a.URL, a.plaintext; f; ) {
    switch (f.nodeType) {
      case Node.ELEMENT_NODE:
        (e += f.innerText), (d += f.outerHTML);
        break;
      case Node.TEXT_NODE:
        (d += f.textContent), (e += f.outerHTML);
        break;
      case Node.CDATA_SECTION_NODE:
        break;
      case Node.COMMENT_NODE:
        break;
      case Node.DOCUMENT_TYPE_NODE:
    }
    f = f.nextSibling;
  }
  (e = na(e.toString())),
    null == Ja && (Ja = ua(a.body.cloneNode(!0))),
    (c = oa(ia(Ja)));
  var g, h;
  return (
    e.length > 5 * c.length && c.length < 2e3
      ? ((g = e), (h = d))
      : ((g = c), (h = Ja)),
    b ? h : g
  );
}
function ua(a) {
  wa(a);
  var b = za(a);
  return Aa(b), b;
}
function va(a) {
  return $("<div/>").text(a).html();
}
function wa(a) {
  if (a.nodeType == Node.ELEMENT_NODE) {
    if (sa(a)) return a.parentNode ? (a.parentNode.removeChild(a), -1) : void 0;
    if (a.children.length > 0)
      for (var b = 0; b < a.children.length; b++)
        wa(a.children[b]) == -1 && b--;
  } else if (a.nodeType != Node.TEXT_NODE)
    return a.parentNode ? (a.parentNode.removeChild(a), -1) : void 0;
}
function xa(a) {
  if (a.nodeType != Node.ELEMENT_NODE)
    return a.parentNode ? (a.parentNode.removeChild(a), -1) : 0;
  if ("H1" == a.nodeName) return 1;
  if (0 == a.getElementsByTagName("H1").length)
    return a.parentNode ? (a.parentNode.removeChild(a), -1) : 0;
  if (a.children.length > 0)
    for (var b = 0; b < a.children.length; b++) {
      var c = xa(a.children[b]);
      if (c == -1) b--;
      else if (1 == c) return 1;
    }
}
function ya(a) {
  var b = getNextNode(a, !0);
  return a.parentNode.removeChild(a), b;
}
function za(a) {
  var b = a;
  if (
    (1 == a.getElementsByTagName("ARTICLE").length
      ? (b = a.getElementsByTagName("ARTICLE")[0])
      : 1 == a.getElementsByTagName("MAIN").length
      ? (b = a.getElementsByTagName("MAIN")[0])
      : 1 == a.getElementsByTagName("CONTENTS").length &&
        (b = a.getElementsByTagName("CONTENTS")[0]),
    b.getElementsByTagName("H1").length > 0)
  )
    xa(b);
  else if (document.title.length > 0) {
    var c = document.createElement("H1");
    (c.textContent = document.title), b.insertBefore(c, b.firstChild);
  }
  return b;
}
function Aa(a, b) {
  if (a.nodeType == Node.ELEMENT_NODE)
    if (ra(a)) {
      if (
        ((a.id = ""),
        (a.className = "ttsreaderx"),
        (a.style = ""),
        a.childNodes.length > 0)
      )
        for (var c = 0; c < a.childNodes.length; c++)
          Aa(a.childNodes[c]) == -1 && c--;
    } else {
      if (!Ha(a))
        return a.parentNode ? (a.parentNode.removeChild(a), -1) : void 0;
      if (
        ((a.id = ""),
        (a.className = "ttsreaderx"),
        (a.style = ""),
        a.childNodes.length > 0)
      )
        for (var c = 0; c < a.childNodes.length; c++)
          Aa(a.childNodes[c]) == -1 && c--;
    }
  else if (a.nodeType != Node.TEXT_NODE)
    return (
      (a.id = ""), a.parentNode ? (a.parentNode.removeChild(a), -1) : void 0
    );
}
function Ba(a) {
  var b = "address,article,aside,blockquote,br,canvas,dd,div,dl,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,li,main,nav,noscript,ol,output,p,pre,section,table,tfoot,ul,video".split(
    ","
  );
  return b.indexOf(a.toLowerCase()) > -1;
}
function Ca(a) {
  var b = "a,b,span,u,i,q,sub,sup".split(",");
  return b.indexOf(a.toLowerCase()) > -1;
}
function ia(a) {
  var b = "";
  if (a.nodeType == Node.TEXT_NODE)
    (b = a.textContent.trim()),
      b.length > 0 &&
        a.parentNode &&
        (Ba(a.parentNode.nodeName) &&
          a.parentNode.firstChild === a &&
          (b = "\n" + b),
        Ba(a.parentNode.nodeName) && a.parentNode.lastChild === a
          ? (b += "\n")
          : (b =
              a.parentNode.parentNode &&
              Ca(a.parentNode.nodeName) &&
              a.parentNode.parentNode.firstChild === a.parentNode &&
              a.parentNode.firstChild === a
                ? "\n" + b
                : " " + b));
  else if (a.nodeType == Node.ELEMENT_NODE && a.childNodes.length > 0)
    for (var c = 0; c < a.childNodes.length; c++) b += ia(a.childNodes[c]);
  return b;
}
function Da(a) {
  var b = "",
    c = "",
    d = "";
  if (sa(a)) return { text: "", content: "" };
  if (a.nodeType == Node.TEXT_NODE) {
    if (a.parentNode) {
      if ("FIGURE" == a.parentNode.nodeName) return { text: "", content: "" };
      if (a.parentNode.parentNode) {
        if ("FIGURE" == a.parentNode.parentNode.nodeName)
          return { text: "", content: "" };
      } else if (a.parentNode.parentNode.parentNode) {
        if ("FIGURE" == a.parentNode.parentNode.parentNode.nodeName)
          return { text: "", content: "" };
      } else if (
        a.parentNode.parentNode.parentNode.parentNode &&
        "FIGURE" == a.parentNode.parentNode.parentNode.parentNode.nodeName
      )
        return { text: "", content: "" };
    }
    (b = a.textContent.trim()),
      b.length > 0 &&
        ((c = ""),
        a.parentNode && "DIV" == a.parentNode.nodeName && (c = "p"),
        0 == c.length && (c = "span"),
        (b += " "));
  } else if (ra(a)) (b = a.innerText), (c = a.nodeName);
  else {
    if ("IMG" == a.tagName)
      return {
        text: "",
        content: "<img class='ttsreaderx' src='" + a.src + "'>",
      };
    var e = $(a);
    if (e.contents().length > 0)
      for (var f = 0; f < e.contents().length; f++) {
        var g = e.contents()[f],
          h = Da(g);
        (b += h.text), (d += h.content);
      }
    c = "";
  }
  (b = b.trim()),
    b.length > 0 && c.length > 0 && "span" != c
      ? (b += "\n\n")
      : b.length > 0 && (b += " "),
    c.length > 0 &&
      b.length > 0 &&
      (d =
        "<" +
        c +
        ' class="ttsreaderx" >' +
        va(b.trim()) +
        "</" +
        c +
        ">&nbsp;"),
    "p" == c && (b = "\n" + b);
  var i = { text: b, content: d };
  return i;
}
function sa(a) {
  if (
    "AUDIO" == a.nodeName ||
    "VIDEO" == a.nodeName ||
    "FIGURE" == a.nodeName ||
    "IMG" == a.nodeName ||
    "NAV" == a.nodeName ||
    "IFRAME" == a.nodeName ||
    "SCRIPT" == a.nodeName ||
    "NOSCRIPT" == a.nodeName ||
    "STYLE" == a.nodeName ||
    "INPUT" == a.nodeName ||
    "TEXTAREA" == a.nodeName ||
    "BUTTON" == a.nodeName ||
    "AREA" == a.nodeName ||
    "COMMENT" == a.nodeName ||
    "ATTRIBUTE" == a.nodeName ||
    "FIGCAPTION" == a.nodeName ||
    "CAPTION" == a.nodeName ||
    "FOOTER" == a.nodeName ||
    (a.nodeType != Node.ELEMENT_NODE && a.nodeType != Node.TEXT_NODE)
  )
    return !0;
  for (
    var b = [
        "disqus",
        " fb ",
        "-fb-",
        "_fb_",
        "-fb ",
        " fb-",
        " fb_",
        "_fb ",
        "social",
        "spinner",
        "video",
        " media ",
        "banner",
        "script",
        "skip",
        "comment",
        "advertisement",
        "_ad",
        "_ads",
        "_ad_",
        " ads",
        " ad ",
        " ad",
        "nav",
        "navigation",
        "menu",
        "share",
        "links",
        "buttons",
        "label",
        "footer",
      ],
      c = 0;
    c < b.length;
    c++
  )
    if (
      "string" == typeof a.className &&
      (
        " " +
        a.className.toLowerCase() +
        " " +
        a.id +
        " " +
        a.role +
        " "
      ).indexOf(b[c]) > -1
    )
      return !0;
  if (a.nodeType == Node.TEXT_NODE) return !1;
  var d = a.style,
    e = window.getComputedStyle(a, null);
  return (
    (prop = "display"),
    !(!d.hasOwnProperty(prop) || ("none" != e[prop] && "none" != d.display)) ||
      ((prop = "visibility"),
      !(
        !d.hasOwnProperty(prop) ||
        ("hidden" != e[prop] && "hidden" != d.visibility)
      ) ||
        !a.innerText ||
        !(!a.innerText || 0 != a.innerText.trim().length))
  );
}
function Ea(a) {
  return (
    null !== a.offsetParent ||
    !!(a.offsetWidth || a.offsetHeight || a.getClientRects().length)
  );
}
function qa(a) {
  if (a.nodeType != Node.ELEMENT_NODE && a.nodeType != Node.TEXT_NODE)
    return !1;
  for (
    var b = ["content", "main", "article", "text", "txt", "some-other-class"],
      c = 0;
    c < b.length;
    c++
  )
    if (
      "string" == typeof a.className &&
      a.className.toLowerCase().indexOf(b[c]) > -1
    )
      return !0;
  return !1;
}
function ra(a) {
  if (a.nodeType != Node.ELEMENT_NODE && a.nodeType != Node.TEXT_NODE)
    return !1;
  var b = [
    "PRE",
    "CODE",
    "H1",
    "H2",
    "H3",
    "H4",
    "H5",
    "H6",
    "H7",
    "H8",
    "H9",
    "H10",
    "P",
    "ARTICLE",
    "MAIN",
    "A",
    "SPAN",
    "B",
    "I",
    "EM",
    "U",
    "FONT",
    "STRONG",
    "MARK",
    "SMALL",
    "SUB",
    "SUP",
    "INS",
    "Q",
    "BLOCKQUOTE",
    "SECTION",
    "SUMMARY",
  ];
  return b.indexOf(a.tagName) > -1;
}
function Fa(a) {
  var b = ["IMG", "FIGURE", "AUDIO", "VIDEO"];
  return b.indexOf(a.nodeName) > -1;
}
function Ga(a) {
  return (
    a.getElementsByTagName("ARTICLE").length > 0 ||
    a.getElementsByTagName("P").length > 0 ||
    a.getElementsByTagName("H1").length > 0 ||
    a.getElementsByTagName("H2").length > 0 ||
    a.getElementsByTagName("H3").length > 0 ||
    a.getElementsByTagName("H4").length > 0 ||
    a.getElementsByTagName("H5").length > 0 ||
    a.getElementsByTagName("H6").length > 0
  );
}
function Ha(a) {
  if (qa(a)) return !0;
  if (Ga(a)) return !0;
  if (a.innerText) {
    for (
      var b = 0, c = a.innerText.length, d = a.getElementsByTagName("A"), e = 0;
      e < d.length;
      e++
    )
      d[e].innerText && (b += d[e].innerText.length);
    return !(b > c / 2 || c < 20);
  }
  return !1;
}
function na(a) {
  return (a = da(a)), (a = ea(a)), (a = ha(a)), (a = oa(a));
}
function da(a) {
  return (a = a.replace(/^\w{1,}\n+/gm, ""));
}
function ea(a) {
  return (a = a.replace(/^\w{2,} \w{2,}\n/gm, ""));
}
function fa(a) {
  return (a = a.replace(/^\w{2,} \w{2,} \w{2,}\n/gm, ""));
}
function ga(a) {
  return (a = a.replace(/([A-Z]{2,})\w+/g, ""));
}
function ha(a) {
  return (a = a.replace(/\t/g, ""));
}
function oa(a) {
  return (a = a.replace(/\n\s*\n\s*\n/g, "\n\n"));
}
function ja(a) {}
function D(a) {
  chrome.runtime.sendMessage({ message_id: "page_content", source: a });
}
function E(a) {
  var b = document.createElement("DIV");
  return (b.innerHTML = a), b.textContent || b.innerText || "";
}
function F(a) {
  var b = JSON.parse(a),
    c = b.query.pages;
  Object.keys(c).forEach(function (a, b) {
    var d = E(c[a].extract);
    D(d);
  });
}
function G(a, b) {
  var c = new XMLHttpRequest();
  (c.onreadystatechange = function () {
    4 == c.readyState && 200 == c.status && b(c.responseText);
  }),
    c.open("GET", a, !0),
    c.send(null);
}
function H(a) {
  var b = a,
    c = b.lastIndexOf("/"),
    d = b.substring(c + 1),
    e = b.substring(b.indexOf("//"), b.indexOf(".wikipedia.org")),
    f =
      "https://" +
      e +
      ".wikipedia.org/w/api.php?format=json&action=query&prop=extracts&titles=" +
      d;
  return f;
}
function Ia() {
  document.URL.includes("wikipedia.org") && !document.URL.includes("Main_Page")
    ? G(H(document.URL), F)
    : D(C(document));
}
var Ja = null;
this.getNextNode = function (a, b) {
  if (!b && a.firstElementChild) return a.firstElementChild;
  if (a.nextElementSibling) return a.nextElementSibling;
  do a = a.parentNode;
  while (a && !a.nextElementSibling);
  return a && a.nextElementSibling;
};
