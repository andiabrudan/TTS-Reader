function Ka() {
  Ma(1.2);
}
function La() {
  Ma(1 / 1.2);
}
function Ma(a) {
  var b = document.getElementById("ttsreaderx"),
    c = window.getComputedStyle(b, null).getPropertyValue("font-size"),
    d = parseFloat(c);
  b.style.fontSize = d * a + "px";
}
function Na() {
  document.body.removeChild(document.getElementById("ttsreaderx_header")),
    document.body.removeChild(document.getElementById("ttsreaderx")),
    (Sa = !1);
}
function Oa() {
  Pa("ttsreaderx");
}
function Pa(a) {
  var b = window.open("", "PRINT", "height=400,width=600");
  return (
    b.document.write("<html><head><title>" + document.title + "</title>"),
    b.document.write(
      "<style>#ttsreaderx,#ttsreaderx_header{position:fixed;left:0;right:0;z-index:999999999999999999}#ttsreaderx_header{top:0;width:100%;height:60px;background-color:#eee;border-bottom:solid gray 1px}#ttsreaderx_loader{display:block;margin:50px auto;border:16px solid #f3f3f3;border-top:16px solid #3498db;border-radius:50%;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.ttsreaderx-btn{width:40px;height:40px;background-color:transparent;background-size:contain;display:inline-block;margin:10px;cursor:pointer}#ttsreaderx{padding:20px;top:60px;bottom:0;overflow-y:scroll;background-color:#fff;font-size:large;font-family:sans-serif}#ttsreaderx-content{max-width:600px;margin:auto;font-family:inherit}.ttsreaderx{all:initial;display:block;background-color:#fff;color:#000;font-size:1em;font-family:inherit;margin:.5em 0;text-align:justify}h1.ttsreaderx,h2.ttsreaderx{text-align:center;margin:1em 0 .5em;font-weight:700}h1.ttsreaderx{font-size:2em}h2.ttsreaderx{font-size:1.4em}h3.ttsreaderx,h4.ttsreaderx,h5.ttsreaderx,h6.ttsreaderx,h7.ttsreaderx,h8.ttsreaderx,h9.ttsreaderx{font-size:1.1em;font-weight:700}article.ttsreaderx,p.ttsreaderx{white-space:pre-line}img.ttsreaderx{display:block;max-width:90%;margin:20px auto}a.ttsreaderx,span.ttsreaderx{display:inline}</style>"
    ),
    b.document.write('</head><body onload="printMe()">'),
    b.document.write(document.getElementById(a).innerHTML),
    b.document.write("</body></html>"),
    b.document.close(),
    (b.onload = function () {
      b.focus(), b.print(), b.close();
    }),
    !0
  );
}
function n(a) {
  for (var b = new Date().getTime(), c = b; c < b + a; )
    c = new Date().getTime();
}
var Qa = !0,
  Ra = "xx-small,x-small,small,medium,large,x-large,xx-large".split(","),
  Sa = !1,
  Ta = document.body.innerHTML;
chrome.runtime.onMessage.addListener(function (a, b, c) {
  if ("getPagesSource" == a.action) Ia();
  else if ("toggleReadability" == a.action)
    if (Sa) Na();
    else {
      var d = document.cloneNode(!0);
      document.body.cloneNode(!0);
      Ta = document.body.innerHTML;
      var e = chrome.extension.getURL("images/ic_highlight_off_black_24px.svg"),
        f = chrome.extension.getURL("images/ic_print_black_24px.svg"),
        g = chrome.extension.getURL("images/ic_zoom_in_black_24px.svg"),
        h = chrome.extension.getURL("images/ic_zoom_out_black_24px.svg"),
        i = chrome.extension.getURL("images/wood_texture.jpg"),
        j = $.parseHTML(
          "<div id='ttsreaderx_header'><div class='ttsreaderx-btn' id='ttsreaderx_exit_btn'></div><div class='ttsreaderx-btn' id='ttsreaderx_print_btn'></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class='ttsreaderx-btn' id='ttsreaderx_zoomout_btn'></div><div class='ttsreaderx-btn' id='ttsreaderx_zoomin_btn'></div></div>"
        ),
        k = document.createElement("DIV");
      k.setAttribute("id", "ttsreaderx"),
        (k.innerHTML = '<div id="ttsreaderx_loader"></div>');
      if (
        (document.body.appendChild(j[0]),
        document.body.appendChild(k),
        (document.getElementById("ttsreaderx_exit_btn").style.backgroundImage =
          'url("' + e + '")'),
        (document.getElementById("ttsreaderx_print_btn").style.backgroundImage =
          'url("' + f + '")'),
        (document.getElementById(
          "ttsreaderx_zoomin_btn"
        ).style.backgroundImage = 'url("' + g + '")'),
        (document.getElementById(
          "ttsreaderx_zoomout_btn"
        ).style.backgroundImage = 'url("' + h + '")'),
        document
          .getElementById("ttsreaderx_exit_btn")
          .addEventListener("click", Na),
        document
          .getElementById("ttsreaderx_print_btn")
          .addEventListener("click", Oa),
        document
          .getElementById("ttsreaderx_zoomin_btn")
          .addEventListener("click", Ka),
        document
          .getElementById("ttsreaderx_zoomout_btn")
          .addEventListener("click", La),
        Qa)
      ) {
        var m = !0;
        null != Ja && Ja.innerText
          ? ((Ja = C(d, m)), (m = !1))
          : ((Ja = C(d, m)), (m = !1)),
          (k.innerHTML =
            '<div id="ttsreaderx-content">' + Ja.innerHTML + "</div>");
      } else {
        var n = document.location,
          o = {
            spec: n.href,
            host: n.host,
            prePath: n.protocol + "//" + n.host,
            scheme: n.protocol.substr(0, n.protocol.indexOf(":")),
            pathBase:
              n.protocol +
              "//" +
              n.host +
              n.pathname.substr(0, n.pathname.lastIndexOf("/") + 1),
          };
        (null != Ja && Ja.innerText) || (Ja = new ta(o, d).parse()),
          (k.innerHTML = ""),
          (k.innerHTML =
            '<div id="ttsreaderx-content">' + Ja.content + "</div>");
      }
      a.isPremium ||
        ((document.getElementById("ttsreaderx_nonpremium").style.visibility =
          "visible"),
        (document.getElementById(
          "ttsreaderx_nonpremium"
        ).style.backgroundImage = 'url("' + i + '")'),
        $("#ttsreaderx_nonpremium").fadeOut(10),
        (document.getElementById("ttsreaderx_print_btn").style.pointerEvents =
          "none"),
        (document.getElementById("ttsreaderx_print_btn").title =
          "This print button is a Premium feature"),
        setTimeout(function () {
          $("#ttsreaderx_nonpremium").fadeIn(5e3);
        }, 5e3)),
        (Sa = !0);
    }
});
