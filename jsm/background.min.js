function Y(){for(var a=[],b=0;b<B.length;b++){var c=["",""],d=B[b];c[0]=d.name,B.filter(function(a){return a.lang.split("-")[0]==d.lang.split("-")[0]}).length>1?c[1]=_(d.lang)+", "+$(d.name):c[1]=_(d.lang),a[b]=c}return a=Z(a)}function Z(a){return void 0==a||null==a?a:"[object Array]"===Object.prototype.toString.call(a)?a.sort(function(a,b){var c=a[1].toUpperCase(),d=b[1].toUpperCase();return c<d?-1:c>d?1:0}):void 0}function $(a){var b=a;return a=a.toLowerCase(),a.includes("google")&&(b=a.includes("female")?"Female":a.includes("male")?"Male":"G"),b}function _(a){for(var b=[["en","English, US"],["en-US","English, US"],["id-ID","Bahasa, Indonesia"],["ms-MY","Bahasa, Melayu"],["bg-BG","Bulgarian"],["cs-CZ","Czech"],["da-DK","Danish, Denmark"],["de-DE","Deutsch"],["nl-NL","Dutch, Netherlands"],["nl-BE","Dutch, Belgium"],["en-AU","English, Australia"],["en-CA","English, Canada"],["en-IN","English, India"],["en-IE","English, Ireland"],["en-NZ","English, New Zealand"],["en-ZA","English, S. Africa"],["en-GB","English, UK"],["en-US","English, US"],["es-AR","español, Argentina"],["es-BO","español, Bolivia"],["es-CL","español, Chile"],["es-CO","español, Colombia"],["es-CR","español, Costa Rica"],["es-EC","español, Ecuador"],["es-SV","español, El Salvador"],["es-ES","español, España"],["es-US","español, Estados Unidos"],["es-GT","español, Guatemala"],["es-HN","español, Honduras"],["es-MX","español, México"],["es-NI","español, Nicaragua"],["es-PA","español, Panamá"],["es-PY","español, Paraguay"],["es-PE","español, Perú"],["es-PR","español, Puerto Rico"],["es-DO","español, R. Dominicana"],["es-UY","español, Uruguay"],["es-VE","español, Venezuela"],["fr-FR","français"],["fr-CA","français, Canada"],["hi-IN","Hindi"],["is-IS","Icelandic"],["zu-ZA","IsiZulu"],["it-IT","italiano"],["it-CH","italiano, Svizzera"],["ko-KR","Korean"],["hu-HU","Magyar"],["nb-NO","Norwegian"],["pl-PL","Polski"],["pt-BR","Português, Brasil"],["pt-PT","Português, Portugal"],["ro-RO","română"],["ru-RU","России"],["sr-RS","Serbian"],["sk-SK","Slovak"],["fi-FI","Suomi"],["sv-SE","Svenska"],["th-TH","Thai"],["tr-TR","Turkish"],["el-GR","Ελληνικά"],["zh-CN","普通话 (中国大陆)"],["zh-HK","普通话 (香港)"],["zh-TW","中文 (台灣)"],["cmn-Hans-CN","普通话 (中国大陆)"],["cmn-Hans-HK","普通话 (香港)"],["cmn-Hant-TW","中文 (台灣)"],["yue-Hant-HK","粵語 (香港)"],["ja-JP","日本の"],["he-IL","עברית"],["ar-DZ","العربية, Algeria"],["ar-EG","العربية, Egypt"],["ar-IQ","العربية, Iraq"],["ar-JO","العربية, Jordan"],["ar-KW","العربية, Kuwait"],["ar-LB","العربية, Lebanon"],["ar-MA","العربية, Morocco"],["ar-QA","العربية, Qatar"],["ar-SA","العربية, Saudi Arabia"],["ar-AE","العربية, UAE"]],c=0;c<b.length;c++)if(b[c][0]==a)return b[c][1];for(var c=0;c<b.length;c++)if(b[c][0].split("-")[0]==a.split("-")[0])return b[c][1].split(",")[0];return a}function ic(){lc=window.setInterval(function(){window.speechSynthesis.speaking&&Date.now()-x>=1e4&&(window.speechSynthesis.pause(),window.speechSynthesis.resume(),x=Date.now())},2e3)}function jc(){window.clearInterval(lc)}function a(a){u=a,d(0)}function b(a,b){s=!0,u=a,d(b),w=0,z.text="",l(!0),ic(),h(),chrome.runtime.sendMessage({message_id:"speech_started_in_bg",text:u})}function c(){s=!1,Gb=!1,speechSynthesis.cancel(),jc(),l(!1),chrome.runtime.sendMessage({message_id:"speech_paused_in_bg"})}function d(a){t=a,chrome.runtime.sendMessage({message_id:"set_caret_position",data:a}),k(a,a)}function e(a){if(B=window.speechSynthesis.getVoices(),null!==window.chrome&&void 0!==window.chrome&&null!==B&&void 0!==B)switch(a){case"en-GB":z.voice=B.filter(function(a){return"Google UK English Male"==a.name})[0];break;default:B.filter(function(b){return b.name==a}).length>0?z.voice=B.filter(function(b){return b.name==a})[0]:B.filter(function(b){return b.lang==a}).length>0?z.voice=B.filter(function(b){return b.lang==a})[0]:B.filter(function(a){return"Google UK English Male"==a.name}).length>0?z.voice=B.filter(function(a){return"Google UK English Male"==a.name})[0]:z.voice=B.filter(function(a){return"en-GB"==a.lang})[0]}z.lang=z.voice.lang,chrome.storage.local.set({stored_lang:z.voice.name},function(){})}function f(a){z.rate=a,chrome.storage.local.set({stored_rate:a},function(){})}function g(){w=0,d(0),s&&speechSynthesis.cancel()}function h(){var a=u.substring(t),b=i(a.slice(0,vc));z.text=a.slice(0,b),w=z.text.length,k(t,t+b);for(var e=' .,"/<>()?;:_”“',f="\n";(e.indexOf(z.text[0])!=-1||f==z.text.substring(0,2))&&z.text.length>0;)z.text=z.text.slice(1);if(a=a.slice(b),z.text.length>0)speechSynthesis.speak(z);else if(a.length>0)d(t+w),t<u.length&&h();else{g();var j=!1;j?h():c()}}function i(a){var b=-1,c=[];return b=a.indexOf("\n"),b>-1&&c.push(b),b=uc(a),b>-1&&c.push(b),b=a.indexOf("!"),b>-1&&c.push(b),b=a.indexOf("?"),b>-1&&c.push(b),c.length>0&&(b=Math.min.apply(null,c),b>-1)?b+1:a.length<vc?a.length+1:(b=a.lastIndexOf(","),b>-1?b+1:(b=Math.max(a.indexOf("("),a.indexOf(")"),a.indexOf("{"),a.indexOf("}"),a.indexOf("["),a.indexOf("]")),b>-1?b+1:(b=a.lastIndexOf(" "),b>-1?b+1:a.length+1)))}function uc(a){for(var b=0;b<a.length;b++)if("."===a.charAt(b)&&(b==a.length-1||"0123456789".indexOf(a.charAt(b+1))===-1))return b;return-1}function j(){c()}function Eb(){b()}function Fb(){c()}function k(a,b){chrome.runtime.sendMessage({message_id:"set_selection_range",selection_start:a,selection_end:b})}function Ua(){chrome.tabs.query({active:!0,currentWindow:!0},function(a){chrome.storage.local.get("isPremium",function(b){chrome.tabs.sendMessage(a[0].id,{action:"toggleReadability",isPremium:b.isPremium},function(a){})})})}function V(){}function l(a){if(a){var b="selection",c="Pause";chrome.contextMenus.update(A,{title:c,contexts:[b]})}else{var b="selection",c="Play Selection";chrome.contextMenus.update(A,{title:c,contexts:[b]})}}function m(a,d){s?c():a.selectionText.length>0&&(v=d.id,b(a.selectionText,0))}function n(a){for(var b=(new Date).getTime(),c=b;c<b+a;)c=(new Date).getTime()}function getText(){return u}function getMasterId(){return v}function getCaretPosition(){return t}function getVoicesList(){return aa}function getIsSpeaking(){return s}function N(){function a(a){T=a[0].id,getMasterId()==T&&(v=-1),Ia(),d(0),k(0,0)}var b={active:!0,currentWindow:!0};getIsSpeaking()&&c(),chrome.tabs.query(b,a)}function Ia(a){chrome.tabs.query({active:!0,currentWindow:!0},function(a){chrome.tabs.sendMessage(a[0].id,{action:"getPagesSource"},function(a){})})}function I(a){s?c():a&&""==u?(kc=!0,N()):b(u,t)}var s=!1,Gb=!1,t=0,u="",v=-1,w=0,x=0,y=0,B=null,aa=null,Hb,kc=!1,Ib,lc=null,mc=0;const vc=300;var z=new SpeechSynthesisUtterance("hello world");z.volume=1,z.rate=.9,z.pitch=1,z.lang="en-GB";var A="ttsreader_context";"speechSynthesis"in window||alert("Speech Synthesis is not supported by your browser. Switch to Chrome."),chrome.tabs.onRemoved.addListener(function(a,b){a==v&&c()}),"speechSynthesis"in window&&(B=window.speechSynthesis.getVoices(),aa=Y(B),window.speechSynthesis.onvoiceschanged=function(){B=window.speechSynthesis.getVoices(),aa=Y(B)}),z.onstart=function(a){x=Date.now()},z.onend=function(a){if(y=Date.now(),s)if(d(t+w),t<u.length)h();else{g();var b=!1;b?h():c()}else t>=u.length&&g()},z.onerror=function(a){speechSynthesis.cancel(),jc(),s&&(ic(),h())},z.onboundary=function(a){},chrome.runtime.onMessage.addListener(function(h,i){switch(h.message_id){case"start_speech":v=h.tab_id,b(h.text,h.caret);break;case"update_text":u=h.text,v=h.tab_id;break;case"page_content":kc&&(kc=!1,u=h.source.toString(),d(0),I());break;case"pause_speech":c();break;case"set_newtext":a(h.source);break;case"update_language":e(h.language);break;case"update_speed":f(h.speed);break;case"go_to_beginning":g();break;case"clear_text":u=h.text,d(h.caret),j();break;case"backreloadtext":N();break;case"backstartorpause":I(!0);break;case"backtogglereadability":Ua();break;case"reset_master":v=-1;break;case"start_recording":Eb();break;case"stop_recording":Fb();break;case"get_voices":sendVoices()}});var W="selection",X="Play Selection";A=chrome.contextMenus.create({title:X,contexts:[W],id:A},V),chrome.contextMenus.onClicked.addListener(m);